__version__ = (1, 4, 8, 8)

#‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢æ‚£∑‚£∂‚£§‚£Ñ‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£Ä‚£Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
#‚¢†‚£§‚£Ñ‚°Ä‚†Ä‚†Ä‚†Ä‚†à‚¢ª‚£ß‚†à‚†â‚†ª‚£∑‚£§‚£Ä‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£æ‚£ø‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
#‚†π‚£ø‚°ü‚†ª‚¢∑‚£¶‚£Ñ‚£Ä‚£¥‚£ø‚£ß‚£Ä‚£Ä‚£¨‚£ø‚£ø‚£ø‚°∑‚†¢‚°Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚°ø‚†ø‚¢õ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
# ‚†ô‚¢ø‚£¶‚°Ä‚†à‚†õ‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°Ä‚†Ä‚¢∏‚£¶‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢£‚°Ä‚†Ä‚†±‚£Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
#‚†Ä‚†Ä‚†Ä‚¢π‚£ø‚£∂‚£æ‚£ø‚°ø‚†ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£∑‚£ø‚£ø‚†ô‚¢Ü‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†±‚¢§‚£æ‚£ø‚£ø‚£ø‚†è‚†â‚†â‚¢â‚£Ω‚£ø‚£∂‚£§‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä
#‚†Ä‚†Ä‚†Ä‚£º‚£ø‚£ø‚£ø‚£ø‚°§‚†ö‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£á‚†Ä‚¢∏‚°Ü‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†â‚†â‚†â‚†Å‚†à‚†â‚†â‚†â‚†ô‚†ª‚£ø‚†ü‚¢¢‚°Ä‚†Ä‚†Ä
#‚†Ä‚†Ä‚¢∞‚°Å‚£ø‚£ø‚£ø‚£ø‚£ß‚°Ä‚£π‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£∑‚£æ‚†É‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚¢Ü‚†Ä‚†±‚°Ä‚†Ä
#‚†Ä‚†Ä‚¢∏‚¢ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ª‚£ø‚£ø‚£ø‚£ø‚£ø‚†è‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ò‚£∑‚£ø‚£ß‚†Ä
#‚†Ä‚†Ä‚¢ª‚¢∏‚£ø‚°ü‚¢ª‚£ø‚£ø‚†õ‚†õ‚†ø‚†õ‚¢π‚¢ø‚£ø‚°ø‚£ø‚£ø‚£ø‚£ø‚†ü‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚£ø‚£ø‚†Ä
#‚†Ä‚†Ä‚¢∏‚£ø‚£ø‚£ø‚†æ‚†Å‚£ø‚£¶‚†Ä‚†Ä‚†Ä‚£á‚°∏‚†è‚†Ä‚£ø‚£ø‚£ø‚†ø‚†¢‚¢Ñ‚£Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚°Ä‚†§‚†Ä‚£§‚£∂‚£∂‚£∂‚£¶‚£§‚£Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∞‚†õ‚†õ‚°è‚†Ä
#‚†Ä‚†Ä‚†Ä‚¢ø‚£ø‚£ø‚°Ü‚†Ä‚†ô‚†õ‚†Å‚†Ä‚£Ä‚†Ä‚†Ä‚¢Ä‚£º‚£ø‚†ü‚°Å‚†Ä‚†Ä‚†Ä‚†à‚†â‚†í‚†ä‚†°‚†§‚†§‚¢º‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†ø‚†∑‚£Ñ‚£Ä‚£∞‚£á‚£Ä‚°¥‚†Å‚†Ä
#‚†Ä‚†Ä‚†Ä‚†à‚†ª‚£ø‚£ø‚†Ä‚†Ç‚†§‚†§‚†§‚†§‚†ñ‚†ä‚£ø‚£ø‚£ø‚†ë‚†å‚£≥‚°Ü‚¢†‚£§‚†¥‚†ä‚†Å‚†â‚†â‚†â‚†í‚†¢‚¢ç‚°ª‚£ø‚°ü‚†Å‚†Ä‚†Ä‚†à‚¢ø‚£ø‚£ø‚†ü‚†Å‚†Ä‚†Ä
#‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†ô‚†ì‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ò‚£ø‚†á‚†Ä‚†Ä‚†à‚¢≥‚†ã‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†â‚£ª‚†É‚†Ä‚†Ä‚†Ä‚†Ä‚£º‚†Ø‚†§‚£Ä‚†Ä‚†Ä‚†Ä
#‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£†‚†ã‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ã‚¢†‚†û‚†Ä‚°Ä‚¢Ä‚°ú‚†Å‚†Ä‚†Ä‚†Ä‚†ë‚¢Ñ‚†Ä
#‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ñ‚†Ä‚£Ä‚¢Ä‚°¥‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚°É‚¢¥‚°ø‚†Ä‚£Æ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†Ü
#‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†â‚†â‚¢ª‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£æ‚£ø‚£∂‚°è‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
#‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚°ú‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚†ú‚†Å‚†Ä‚†ö‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
#‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢†‚†É‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢†‚£¥‚°ä‚¢Å‚††‚†É‚¢Ä‚£á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
#‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†∏‚°Ä‚†Ä‚°Ä‚†Ä‚†Ä‚†à‚†ë‚†¢‚°Ñ‚†Ä‚†Ä‚†Ä‚°º‚†â‚†â‚†â‚†ì‚†í‚†â‚†ò‚¢¶‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚†î‚†Ä
#‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£ß‚°û‚¢Å‚£¥‚£æ‚£ø‚£ø‚£∑‚£¶‚£Ä‚°§‚¢û‚°µ‚†í‚†ì‚¢í‚£¶‚°Ä‚†Ä‚†Ä‚†Ä‚†â‚¢≤‚°¶‚†§‚†ö‚†Å‚†Ä‚†Ä
#‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢π‚£∑‚£ø‚£ø‚£ø‚£ø‚†ü‚†õ‚†ø‚£ø‚°Ñ‚¢∏‚†Ä‚¢Ä‚£¥‚£ø‚£ø‚£ø‚£∑‚°§‚†ñ‚†ä‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
#‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†ª‚£ø‚£ø‚£ø‚°á‚£¥‚£∂‚£Ü‚†ò‚°∑‚£à‚£∞‚£ø‚£ø‚£ø‚£ø‚°ø‚†ü‚†∑‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
#‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ò‚†ø‚£Ø‚†£‚£õ‚£õ‚£Å‚£Ä‚°Ü‚†à‚†ª‚¢ø‚£ø‚£ø‚†è‚†Ä‚†Ä‚¢∞‚£∑‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
#‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚¢¶‚£Ä‚£•‚£¥‚£æ‚£ø‚†Ä‚†Ä‚†Ä‚†â‚†õ‚¢¶‚£Ñ‚£Ä‚£å‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
#‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†â‚°õ‚†õ‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†â‚¢ª‚†ø‚†ã‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
# –æ –±–æ–∂–µ, –∫–∞–∫–æ–π –∂–µ —Å–∞–Ω—à–∞–π–Ω –∞—Ö—É–µ–Ω–Ω—ã–π, –≤—Å–µ –º–∞–ª–æ–ª–µ—Ç–æ—á–∫–∏ —Å–∫–∞—á—É—Ç –Ω–∞ –µ–≥–æ –æ–≥—Ä–æ–º–Ω–æ–º —á–ª–µ–Ω–µ

# meta developer: @sunshinelzt

import io
import os
import asyncio
import logging
import tempfile
from hikkatl import types
from .. import loader, utils

logger = logging.getLogger(__name__)

@loader.tds
class KeeperMod(loader.Module):
    """–ü–∏–∑–¥–µ—Ü –∫–∞–∫–æ–π —É–¥–æ–±–Ω—ã–π –º–æ–¥—É–ª—å –¥–ª—è –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å—è–∫–æ–π —Ö—É–π–Ω–∏, –∫–æ—Ç–æ—Ä–∞—è —Å–∞–º–æ—É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è –Ω–∞—Ö—É–π"""
    
    strings = {
        "name": "Keeper",
        "saved": "<emoji document_id=6046410905829251121>üí•</emoji> <b>–°–ø–∏–∑–¥–∏–ª {media_type}</b>",
        "auto_on": "<emoji document_id=6044327262575141199>üåü</emoji> –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ <b>–≤–∫–ª—é—á–µ–Ω–æ</b>.",
        "auto_off": "<emoji document_id=6044327262575141199>üåü</emoji> –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ <b>–≤—ã–∫–ª—é—á–µ–Ω–æ</b>.",
        "from": "–û—Ç",
        "username": "–Æ–∑–µ—Ä–Ω–µ–π–º",
        "id": "ID",
        "no_media": "–ù–µ—Ç –º–µ–¥–∏–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è",
        "sent_as_document": "<i>(–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç)</i>",
        "sender_unknown": "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",
        "name_unknown": "–Ω–µ —É–∫–∞–∑–∞–Ω",
        "media_types": {
            "photo": "—Ñ–æ—Ç–æ",
            "video": "–≤–∏–¥–µ–æ", 
            "video_note": "–∫—Ä—É–∂–æ—á–µ–∫",
            "voice": "–≥–æ–ª–æ—Å–æ–≤–æ–µ",
            "audio": "–∞—É–¥–∏–æ",
            "animation": "–≥–∏—Ñ–∫—É",
            "document": "—Ñ–∞–π–ª",
            "media": "–º–µ–¥–∏–∞"
        }
    }
    
    strings_ru = {
        "name": "Keeper",
        "saved": "<emoji document_id=6046410905829251121>üí•</emoji> <b>–°–ø–∏–∑–¥–∏–ª {media_type}</b>\n\n",
        "auto_on": "<emoji document_id=6044327262575141199>üåü</emoji> –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ <b>–≤–∫–ª—é—á–µ–Ω–æ</b>.",
        "auto_off": "<emoji document_id=6044327262575141199>üåü</emoji> –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ <b>–≤—ã–∫–ª—é—á–µ–Ω–æ</b>.",
        "from": "–û—Ç",
        "username": "–Æ–∑–µ—Ä–Ω–µ–π–º", 
        "id": "ID",
        "no_media": "–ù–µ—Ç –º–µ–¥–∏–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è",
        "sent_as_document": "<i>(–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç)</i>",
        "sender_unknown": "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ",
        "name_unknown": "–Ω–µ —É–∫–∞–∑–∞–Ω",
        "media_types": {
            "photo": "—Ñ–æ—Ç–æ",
            "video": "–≤–∏–¥–µ–æ", 
            "video_note": "–∫—Ä—É–∂–æ—á–µ–∫",
            "voice": "–≥–æ–ª–æ—Å–æ–≤–æ–µ",
            "audio": "–∞—É–¥–∏–æ",
            "animation": "–≥–∏—Ñ–∫—É",
            "document": "—Ñ–∞–π–ª",
            "media": "–º–µ–¥–∏–∞"
        }
    }

    def __init__(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ–π —ç—Ç–æ–π —Ö—É–π–Ω–∏"""
        self.config = loader.ModuleConfig(
            loader.ConfigValue(
                "auto_save",
                False,
                "–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–∫—Ä—ã—Ç—ã—Ö –º–µ–¥–∏–∞",
                validator=loader.validators.Boolean(),
            ),
            loader.ConfigValue(
                "save_chat",
                "me",
                "–ß–∞—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ–¥–∏–∞ (ID —á–∞—Ç–∞/–∫–∞–Ω–∞–ª–∞/–≥—Ä—É–ø–ø—ã –∏–ª–∏ 'me' –¥–ª—è –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ)",
                validator=loader.validators.String(),
            ),
            loader.ConfigValue(
                "enable_logging",
                False,
                "–í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –º–æ–¥—É–ª—è",
                validator=loader.validators.Boolean(),
            ),
        )
        self._me = None

    async def client_ready(self):
        """–ì–æ—Ç–æ–≤–∏–º—Å—è –∫ —Ä–∞–±–æ—Ç–µ –∫–∞–∫ —Å–ª–µ–¥—É–µ—Ç"""
        self._me = await self._client.get_me()

    def _log(self, level, message):
        """–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–µ–∫"""
        if self.config.get("enable_logging", False):
            getattr(logger, level)(message)

    def is_self_destruct(self, message):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–∞–º–æ—É–Ω–∏—á—Ç–æ–∂–∞—é—â–µ–µ—Å—è –≥–æ–≤–Ω–æ"""
        if not message or not message.media:
            return False
            
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–∫—Ä—ã—Ç—ã–µ —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ (view once)
        if hasattr(message.media, 'spoiler') and message.media.spoiler:
            return True
            
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ –º–µ–¥–∏–∞
        if hasattr(message.media, 'ttl_seconds') and message.media.ttl_seconds:
            return True
            
        # –ù–æ–≤—ã–π –∞—Ç—Ä–∏–±—É—Ç –¥–ª—è –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã—Ö –º–µ–¥–∏–∞ –≤ 2025
        if hasattr(message.media, 'once') and message.media.once:
            return True
            
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ—Å—Ç—å
        if hasattr(message.media, 'document'):
            doc = message.media.document
            if hasattr(doc, 'ttl_seconds') and doc.ttl_seconds:
                return True
            if hasattr(doc, 'once') and doc.once:
                return True
                
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ –≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –≤–∏–¥–µ–æ–∫—Ä—É–∂–æ—á–∫–∏
            for attr in getattr(doc, 'attributes', []):
                if isinstance(attr, types.DocumentAttributeAudio):
                    # –û–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                    if attr.voice and (hasattr(message.media, 'once') and message.media.once):
                        return True
                elif isinstance(attr, types.DocumentAttributeVideo):
                    # –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –≤–∏–¥–µ–æ–∫—Ä—É–∂–æ—á–µ–∫
                    if (attr.round_message and 
                        (hasattr(message.media, 'once') and message.media.once or 
                         hasattr(message.media, 'ttl_seconds') and message.media.ttl_seconds)):
                        return True
                        
        return False

    def get_extension_and_type(self, message):
        """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏ —Ç–∏–ø –º–µ–¥–∏–∞ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏"""
        if not message or not message.media:
            return ".unknown", "document"
        
        # –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å MIME —Ç–∏–ø–æ–≤
        mime_extensions = {
            # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            'image/jpeg': ('.jpg', 'photo'),
            'image/jpg': ('.jpg', 'photo'),
            'image/png': ('.png', 'photo'),
            'image/gif': ('.gif', 'animation'),
            'image/webp': ('.webp', 'photo'),
            'image/avif': ('.avif', 'photo'),
            'image/heic': ('.heic', 'photo'),
            'image/heif': ('.heif', 'photo'),
            'image/bmp': ('.bmp', 'photo'),
            'image/tiff': ('.tiff', 'photo'),
            'image/tif': ('.tif', 'photo'),
            'image/ico': ('.ico', 'photo'),
            'image/svg+xml': ('.svg', 'document'),
            'image/x-icon': ('.ico', 'photo'),
            'image/vnd.microsoft.icon': ('.ico', 'photo'),
            
            # –í–∏–¥–µ–æ
            'video/mp4': ('.mp4', 'video'),
            'video/mpeg': ('.mpeg', 'video'),
            'video/quicktime': ('.mov', 'video'),
            'video/x-msvideo': ('.avi', 'video'),
            'video/avi': ('.avi', 'video'),
            'video/webm': ('.webm', 'video'),
            'video/3gpp': ('.3gp', 'video'),
            'video/x-flv': ('.flv', 'video'),
            'video/x-ms-wmv': ('.wmv', 'video'),
            'video/mkv': ('.mkv', 'video'),
            'video/x-matroska': ('.mkv', 'video'),
            'video/ogg': ('.ogv', 'video'),
            'video/mp2t': ('.ts', 'video'),
            'video/h264': ('.h264', 'video'),
            'video/h265': ('.h265', 'video'),
            
            # –ê—É–¥–∏–æ
            'audio/mpeg': ('.mp3', 'audio'),
            'audio/mp3': ('.mp3', 'audio'),
            'audio/ogg': ('.ogg', 'audio'),
            'audio/wav': ('.wav', 'audio'),
            'audio/wave': ('.wav', 'audio'),
            'audio/x-wav': ('.wav', 'audio'),
            'audio/aac': ('.aac', 'audio'),
            'audio/mp4': ('.m4a', 'audio'),
            'audio/x-m4a': ('.m4a', 'audio'),
            'audio/flac': ('.flac', 'audio'),
            'audio/x-flac': ('.flac', 'audio'),
            'audio/opus': ('.opus', 'audio'),
            'audio/webm': ('.webm', 'audio'),
            'audio/3gpp': ('.3ga', 'audio'),
            'audio/amr': ('.amr', 'audio'),
            'audio/x-ms-wma': ('.wma', 'audio'),
            'audio/vnd.rn-realaudio': ('.ra', 'audio'),
            'audio/x-pn-realaudio': ('.ram', 'audio'),
            
            # –î–æ–∫—É–º–µ–Ω—Ç—ã
            'application/pdf': ('.pdf', 'document'),
            'application/msword': ('.doc', 'document'),
            'application/vnd.openxmlformats-officedocument.wordprocessingml.document': ('.docx', 'document'),
            'application/vnd.ms-excel': ('.xls', 'document'),
            'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': ('.xlsx', 'document'),
            'application/vnd.ms-powerpoint': ('.ppt', 'document'),
            'application/vnd.openxmlformats-officedocument.presentationml.presentation': ('.pptx', 'document'),
            'application/zip': ('.zip', 'document'),
            'application/x-rar-compressed': ('.rar', 'document'),
            'application/x-7z-compressed': ('.7z', 'document'),
            'text/plain': ('.txt', 'document'),
            'application/json': ('.json', 'document'),
            'application/xml': ('.xml', 'document'),
            'text/html': ('.html', 'document'),
            'text/css': ('.css', 'document'),
            'application/javascript': ('.js', 'document'),
        }
        
        # –ü–æ–ª—É—á–∞–µ–º MIME —Ç–∏–ø
        mime_type = getattr(message.media, 'mime_type', '')
        if not mime_type and hasattr(message.media, 'document'):
            mime_type = getattr(message.media.document, 'mime_type', '')
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã –º–µ–¥–∏–∞ —Å–Ω–∞—á–∞–ª–∞
        if hasattr(message.media, 'document') and hasattr(message.media.document, 'attributes'):
            for attr in message.media.document.attributes:
                if isinstance(attr, types.DocumentAttributeAudio):
                    if attr.voice:
                        return '.ogg', 'voice'  # –ì–æ–ª–æ—Å–æ–≤—ã–µ –æ–±—ã—á–Ω–æ –≤ OGG
                    else:
                        # –û–±—ã—á–Ω–æ–µ –∞—É–¥–∏–æ - –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ MIME
                        if mime_type in mime_extensions:
                            ext, media_type = mime_extensions[mime_type]
                            return ext, 'audio'
                        return '.mp3', 'audio'
                        
                elif isinstance(attr, types.DocumentAttributeVideo):
                    if attr.round_message:
                        return '.mp4', 'video_note'  # –í–∏–¥–µ–æ–∫—Ä—É–∂–æ—á–∫–∏ –≤ MP4
                    else:
                        # –û–±—ã—á–Ω–æ–µ –≤–∏–¥–µ–æ
                        if mime_type in mime_extensions:
                            ext, _ = mime_extensions[mime_type]
                            return ext, 'video'
                        return '.mp4', 'video'
                        
                elif isinstance(attr, types.DocumentAttributeFilename) and attr.file_name:
                    # –ë–µ—Ä–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
                    try:
                        file_ext = f".{attr.file_name.split('.')[-1].lower()}"
                        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é
                        if file_ext in ['.jpg', '.jpeg', '.png', '.webp', '.bmp', '.tiff', '.heic', '.avif']:
                            return file_ext, 'photo'
                        elif file_ext in ['.gif']:
                            return file_ext, 'animation'
                        elif file_ext in ['.mp4', '.avi', '.mkv', '.webm', '.mov', '.wmv', '.flv']:
                            return file_ext, 'video'
                        elif file_ext in ['.mp3', '.ogg', '.wav', '.flac', '.aac', '.m4a', '.opus']:
                            return file_ext, 'audio'
                        else:
                            return file_ext, 'document'
                    except:
                        pass
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ MIME —Ç–∏–ø—É
        if mime_type in mime_extensions:
            return mime_extensions[mime_type]
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ –æ—Å–Ω–æ–≤–Ω–æ–º—É —Ç–∏–ø—É MIME
        if mime_type:
            try:
                main_type, sub_type = mime_type.split('/', 1)
                ext = f".{sub_type}"
                
                if main_type == 'image':
                    if sub_type == 'gif':
                        return ext, 'animation'
                    return ext, 'photo'
                elif main_type == 'video':
                    return ext, 'video'
                elif main_type == 'audio':
                    return ext, 'audio'
                else:
                    return ext, 'document'
            except:
                pass
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ —Ç–∏–ø—É –æ–±—ä–µ–∫—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        if hasattr(message.media, 'photo'):
            return '.jpg', 'photo'
        elif hasattr(message.media, 'document'):
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è –≤–∏–¥–µ–æ
            doc = message.media.document
            for attr in getattr(doc, 'attributes', []):
                if isinstance(attr, types.DocumentAttributeVideo) and not attr.round_message:
                    return '.mp4', 'video'
                elif isinstance(attr, types.DocumentAttributeAnimated):
                    return '.gif', 'animation'
        
        # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
        if "image" in mime_type.lower():
            return ".jpg", 'photo'
        elif "video" in mime_type.lower():
            return ".mp4", 'video'
        elif "audio" in mime_type.lower():
            return ".mp3", 'audio'
        
        return ".file", 'document'

    def _make_caption(self, message):
        """–°–æ–∑–¥–∞—ë—Ç –ø–∏–∑–¥–∞—Ç—É—é –ø–æ–¥–ø–∏—Å—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω—è–µ–º–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞"""
        try:
            # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –º–µ–¥–∏–∞ –¥–ª—è –ø–æ–¥–ø–∏—Å–∏
            _, media_type = self.get_extension_and_type(message)
            
            media_name = self.strings["media_types"].get(media_type, self.strings["media_types"]["media"])
            caption = self.strings["saved"].format(media_type=media_name).rstrip('\n')
            
            sender = message.sender
            if sender and hasattr(sender, 'id'):
                try:
                    first_name = getattr(sender, 'first_name', None) or self.strings["name_unknown"]
                    last_name = getattr(sender, 'last_name', None) or ''
                    username = getattr(sender, 'username', None) or ''
                    sender_id = sender.id
                    
                    display_name = str(first_name)
                    if last_name:
                        display_name += f" {last_name}"
                    
                    # –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º HTML
                    display_name = utils.escape_html(display_name) if hasattr(utils, 'escape_html') else display_name.replace('<', '&lt;').replace('>', '&gt;')
                    
                    caption += f"<b>{self.strings['from']}:</b> <a href='tg://user?id={sender_id}'>{display_name}</a>\n"
                    
                    if username:
                        caption += f"<b>{self.strings['username']}:</b> @{username}\n"
                    
                    caption += f"<b>{self.strings['id']}:</b> <code>{sender_id}</code>"
                except Exception as sender_error:
                    self._log("warning", f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è: {sender_error}")
                    caption += f"<b>{self.strings['id']}:</b> <code>{getattr(sender, 'id', self.strings['sender_unknown'])}</code>"
            else:
                caption += f"<b>–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å:</b> {self.strings['sender_unknown']}"
            
            return caption
        except Exception as e:
            self._log("warning", f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∏: {e}")
            return self.strings["saved"].format(media_type=self.strings["media_types"]["media"]) + f"<b>–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∏</b>"

    def _get_save_chat(self):
        """–ü–æ–ª—É—á–∞–µ—Ç ID —á–∞—Ç–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è"""
        save_chat = self.config.get("save_chat", "me")
        
        if save_chat == "me":
            return "me"
        
        # –ü—Ä–æ–±—É–µ–º –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ —á–∏—Å–ª–æ
        try:
            return int(save_chat)
        except (ValueError, TypeError):
            self._log("warning", f"–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç ID —á–∞—Ç–∞: {save_chat}, –∏—Å–ø–æ–ª—å–∑—É—é 'me'")
            return "me"

    async def save_media(self, message):
        """–°–æ—Ö—Ä–∞–Ω—è–µ–º —ç—Ç—É —Ö—É–π–Ω—é"""
        temp_file_path = None
        
        try:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º–µ–¥–∏–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            if not message or not message.media:
                self._log("warning", "–ü—É—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –º–µ–¥–∏–∞")
                return False
            
            # –ü–æ–ª—É—á–∞–µ–º —á–∞—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            save_chat = self._get_save_chat()
            
            # –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É
            temp_dir = tempfile.gettempdir()
            ext, media_type = self.get_extension_and_type(message)
            timestamp = int(utils.time.time())
            
            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–º—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
            temp_filename = f"keeper_{timestamp}_{message.sender_id if message.sender else 'unknown'}{ext}"
            temp_file_path = os.path.join(temp_dir, temp_filename)
            
            # –°–∫–∞—á–∏–≤–∞–µ–º –º–µ–¥–∏–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
            try:
                await asyncio.wait_for(
                    message.download_media(temp_file_path), 
                    timeout=120.0  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ç–∞–π–º–∞—É—Ç –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
                )
            except asyncio.TimeoutError:
                self._log("error", "–¢–∞–π–º–∞—É—Ç –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ –º–µ–¥–∏–∞")
                return False
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–∞–π–ª —Å–æ–∑–¥–∞–ª—Å—è –∏ –Ω–µ –ø—É—Å—Ç–æ–π
            if not os.path.exists(temp_file_path) or os.path.getsize(temp_file_path) == 0:
                self._log("error", "–°–∫–∞—á–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –ø—É—Å—Ç–æ–π –∏–ª–∏ –Ω–µ —Å–æ–∑–¥–∞–ª—Å—è")
                return False
            
            caption = self._make_caption(message)
            
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –º–µ–¥–∏–∞ –∏–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º
            max_attempts = 3
            for attempt in range(max_attempts):
                try:
                    with open(temp_file_path, 'rb') as f:
                        file_data = f.read()
                    
                    # –ò—Å–ø–æ–ª—å–∑—É–µ–º BytesIO –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
                    file_io = io.BytesIO(file_data)
                    file_io.name = f"media{ext}"
                    
                    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–ø–æ—Å–æ–± –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ —Ç–∏–ø—É –º–µ–¥–∏–∞
                    if media_type == 'voice':
                        # –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                        await self._client.send_file(
                            save_chat,
                            file_io,
                            caption=caption,
                            voice_note=True,
                            parse_mode='html'
                        )
                    elif media_type == 'video_note':
                        # –í–∏–¥–µ–æ–∫—Ä—É–∂–æ—á–µ–∫
                        await self._client.send_file(
                            save_chat,
                            file_io,
                            caption=caption,
                            video_note=True,
                            parse_mode='html'
                        )
                    elif media_type in ['photo', 'animation']:
                        # –§–æ—Ç–æ –∏ –∞–Ω–∏–º–∞—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–∞–∫ –º–µ–¥–∏–∞
                        await self._client.send_file(
                            save_chat,
                            file_io,
                            caption=caption,
                            parse_mode='html',
                            force_document=False
                        )
                    elif media_type == 'video':
                        # –í–∏–¥–µ–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–∞–∫ –º–µ–¥–∏–∞
                        await self._client.send_file(
                            save_chat,
                            file_io,
                            caption=caption,
                            parse_mode='html',
                            force_document=False,
                            supports_streaming=True
                        )
                    elif media_type == 'audio':
                        # –ê—É–¥–∏–æ —Ñ–∞–π–ª—ã –∫–∞–∫ –º–µ–¥–∏–∞
                        await self._client.send_file(
                            save_chat,
                            file_io,
                            caption=caption,
                            parse_mode='html',
                            force_document=False
                        )
                    else:
                        # –î–æ–∫—É–º–µ–Ω—Ç—ã –∏ –æ—Å—Ç–∞–ª—å–Ω–æ–µ
                        await self._client.send_file(
                            save_chat,
                            file_io,
                            caption=caption,
                            parse_mode='html',
                            force_document=True
                        )
                    
                    self._log("info", f"–ú–µ–¥–∏–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –∫–∞–∫ {media_type} –≤ {save_chat}: {temp_file_path}")
                    return True
                    
                except Exception as send_error:
                    self._log("error", f"–ü–æ–ø—ã—Ç–∫–∞ {attempt + 1} –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–µ —É–¥–∞–ª–∞—Å—å: {send_error}")
                    if attempt == max_attempts - 1:
                        # –ü—Ä–æ–±—É–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç –≤ –∫—Ä–∞–π–Ω–µ–º —Å–ª—É—á–∞–µ
                        try:
                            with open(temp_file_path, 'rb') as f:
                                file_data = f.read()
                            file_io = io.BytesIO(file_data)
                            file_io.name = f"backup_media{ext}"
                            
                            await self._client.send_file(
                                save_chat,
                                file_io,
                                caption=caption + "\n" + self.strings["sent_as_document"],
                                parse_mode='html',
                                force_document=True
                            )
                            self._log("warning", f"–ú–µ–¥–∏–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ—Å–ª–µ –Ω–µ—É–¥–∞—á–∏ –≤ {save_chat}")
                            return True
                        except Exception as backup_error:
                            self._log("error", f"–î–∞–∂–µ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å: {backup_error}")
                            return False
                    await asyncio.sleep(1)
            
            return False
            
        except Exception as e:
            self._log("error", f"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –º–µ–¥–∏–∞: {e}")
            return False
        finally:
            # –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —É–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
            if temp_file_path and os.path.exists(temp_file_path):
                try:
                    os.remove(temp_file_path)
                    self._log("debug", f"–í—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —É–¥–∞–ª–µ–Ω: {temp_file_path}")
                except Exception as cleanup_error:
                    self._log("warning", f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞: {cleanup_error}")

    @loader.command(
        ru_doc="–ó–∞–±—Ä–∞—Ç—å –º–µ–¥–∏–∞ –ø–æ —Ä–µ–ø–ª–∞—é"
    )
    async def kp(self, message):
        """–ó–∞–±—Ä–∞—Ç—å –º–µ–¥–∏–∞ –ø–æ —Ä–µ–ø–ª–∞—é"""
        try:
            # –°—Ä–∞–∑—É —É–¥–∞–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É –¥–ª—è —Å–∫—Ä—ã—Ç–Ω–æ—Å—Ç–∏
            await message.delete()
            
            reply = await message.get_reply_message()
            if not reply or not reply.media:
                self._log("warning", "–ù–µ—Ç —Ä–µ–ø–ª–∞—è –∏–ª–∏ –º–µ–¥–∏–∞ –≤ —Ä–µ–ø–ª–∞–µ")
                return
                
            if not self.is_self_destruct(reply):
                self._log("info", "–ú–µ–¥–∏–∞ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–º")
                return
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–µ–¥–∏–∞ –≤ —Ñ–æ–Ω–µ –±–µ–∑ –≤—Å—è–∫–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            await self.save_media(reply)
            
        except Exception as e:
            self._log("error", f"–û—à–∏–±–∫–∞ –≤ –∫–æ–º–∞–Ω–¥–µ kp: {e}")
            # –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ —É–¥–∞–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É
            try:
                await message.delete()
            except:
                pass

    @loader.command(
        ru_doc="–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ"
    )
    async def akp(self, message):
        """–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ"""
        self.config["auto_save"] = not self.config["auto_save"]
        
        status_msg = self.strings["auto_on"] if self.config["auto_save"] else self.strings["auto_off"]
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å —Ç–æ–ª—å–∫–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º –∏–ª–∏ –õ–° —Å —Å–∞–º–∏–º —Å–æ–±–æ–π
        if utils.get_chat_id(message) == self._me.id or message.is_private:
            temp_msg = await utils.answer(message, status_msg)
            await message.delete()
            await asyncio.sleep(2)
            try:
                await temp_msg.delete()
            except:
                pass
        else:
            # –í –¥—Ä—É–≥–∏—Ö —á–∞—Ç–∞—Ö –ø—Ä–æ—Å—Ç–æ —É–¥–∞–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É
            await message.delete()

    async def watcher(self, message):
        """–°–º–æ—Ç—Ä–∏–º –∑–∞ –≤—Å–µ–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –∫–∞–∫ –µ–±–∞–Ω—ã–µ —à–ø–∏–æ–Ω—ã"""
        if not self.config.get("auto_save", False):
            return
            
        if not message or not message.media:
            return
            
        if not self.is_self_destruct(message):
            return
            
        # –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–≤–æ–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        if message.sender_id == self._me.id:
            return
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–µ–¥–∏–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤ —Ñ–æ–Ω–µ, –Ω–∏–∫–∞–∫–∏—Ö —Å–ª–µ–¥–æ–≤
        try:
            await self.save_media(message)
        except Exception as e:
            self._log("error", f"–û—à–∏–±–∫–∞ –≤ watcher –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: {e}")
